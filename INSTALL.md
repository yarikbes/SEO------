# Установка/Обновление букмарклета

## Размер
- **Текущий размер**: 353 символа (букмарклет только загружает внешний скрипт)  
- **Лимит браузера**: 10,000 символов  
- **Запас**: 9,647 символов ✅

## Инструкция по установке

### 1. Скопировать код
Откройте файл `Check Hreflang.txt` и скопируйте весь код (начинается с `javascript:(function(){...`).

### 2. Создать закладку
1. Откройте браузер
2. Нажмите `Ctrl+D` для создания новой закладки
3. Назовите её "Check Hreflang"
4. В поле URL вставьте скопированный код
5. Сохраните

### 3. Обновить существующий букмарклет
1. Правой кнопкой мыши на существующую закладку "Check Hreflang"
2. Выберите "Изменить" (Edit)
3. Замените старый код на новый
4. Сохраните

## Что нового в этой версии

### ✅ Внешний скрипт
- В закладке остался только загрузчик (`Check Hreflang.txt`).
- Основная логика хранится в `hreflang-checker.js` на GitHub Pages, поэтому:
  - обновления подтягиваются без переустановки закладки;
  - размер букмарклета всегда далёк от лимита.

### ✅ Безопасность и UX
- Все DOM-узлы создаются через `createElement`/`textContent`, никаких вставок HTML строкой.
- Алиасы из `slugs.json` учитываются при определении групп (корень `/`, promo-code и др.).
- Проверка на двойные слэши игнорирует протокол `https://` и смотрит только на путь.
- Текущая страница подсвечивается гарантированно: URL нормализуются перед сравнением.

### ✅ Жёсткая проверка hreflang
- В `slugs.json` теперь хранится список hreflang-кодов для каждого slug.
- Ошибка показывает какой slug ожидается для конкретного hreflang (например, `de-DE → /kyc-richtlinie`).
- Это помогает ловить копипасту и неверные привязки языков.

### ✅ Автоопределение клоакинга
Если на странице нет `<link rel="alternate" hreflang>`, скрипт ставит куку `showCloak=1` и перезагружает страницу. Повторный запуск покажет предупреждение. Это помогает обнаружить случаи, когда hreflang скрывают от ботов.

## Тестирование

### Тест 1: Нормальный сайт с hreflang
- Откройте сайт с hreflang-тегами
- Запустите букмарклет
- **Ожидается**: Таблица с анализом всех hreflang

### Тест 2: Сайт с клоакингом
- Откройте `https://wizzspin-casino.net/` (или другой сайт с клоакингом)
- Запустите букмарклет
- **Ожидается**: 
  - Страница автоматически перезагрузится
  - Повторный запуск покажет результаты анализа

### Тест 3: Сайт без hreflang
- Откройте обычный сайт без hreflang
- Запустите букмарклет дважды
- **Ожидается**: Модальное окно с предупреждением

## История изменений

### v2.7 (03.12.2025) - commit a6ce078
- Вынесена логика букмарклета в `hreflang-checker.js`
- Добавлены алиасы для корневой страницы `/` и новая группа `kyc`
- Исправлена ложная проверка "двойных слэшей"
- Обновлены `convert_to_json.py`, README/INSTALL
- Добавлена база допустимых hreflang → slug и проверка языков

### v2.1 (31.10.2025) - commit e5f6713
- Оптимизирован размер с 10,084 до 5,785 символов
- Добавлена автоматическая установка куки для обнаружения клоакинга
- Улучшено модальное окно для случая отсутствия hreflang

### v2.0 (26.10.2025) - commit 4d8d553
- Расширена база слагов до 447 записей
- Добавлена группа "betting" с /wedden (NL)
- Добавлены переводы "app" для 17 языков
- Исправлен баг с undefined currentGroup
- Улучшена читаемость модальных окон

## Файлы проекта
- `Check Hreflang.txt` — загрузчик букмарклета (~353 символа)
- `hreflang-checker.js` — основная логика проверки (подгружается с GitHub Pages)
- `slugs.json` — база данных слагов v2.7 (524 строки)
- `convert_to_json.py` — генератор JSON из CSV
- `URL на разных языках - Вариант Б (развёрнутый).csv` — актуальная таблица
- `README.md`, `INSTALL.md`, `ИНСТРУКЦИЯ.md`, `CHANGELOG_v2.md`
